# 资讯数据模型说明

## 📋 数据模型定义

资讯文章（Article）的完整数据模型如下：

```json
{
  "id": 1,                          // 必需：唯一标识符（整数）
  "title": "文章标题",              // 必需：文章标题
  "url": "https://article-url.com", // 必需：文章链接（唯一）
  "source": "来源名称",             // 可选：来源（公众号名/网站名），为空时显示"未知来源"
  "summary": "文章摘要",            // 可选：文章摘要
  "category": "programming",        // 必需：文章分类（programming, ai_news等）
  "archived_at": "2025-01-08T10:00:00Z",  // 必需：采纳/归档时间（ISO 8601格式）
  "created_at": "2025-01-08T10:00:00Z",  // 必需：创建时间（ISO 8601格式）
  "published_time": "2025-01-08T10:00:00Z", // 可选：原始发布时间（ISO 8601格式）
  "tool_tags": ["工具名称1", "工具名称2"], // 可选：工具标签列表（用于工具详情页关联）
  "tags": ["标签1", "标签2"],      // 可选：普通标签列表
  "view_count": 0,                 // 可选：点击次数（热度），默认为0
  "score": 8.5                     // 可选：热度分（0-10）
}
```

## 🔑 必需字段（Required Fields）

以下字段在归档文章时**必须**存在：

1. **`id`** - 唯一标识符
   - 如果归档时没有，系统会自动生成（从现有文件中找到最大ID+1）

2. **`title`** - 文章标题
   - 必须提供

3. **`url`** - 文章链接
   - 必须提供，用于去重和唯一标识

4. **`category`** - 文章分类
   - 必须提供，如：`programming`、`ai_news`

5. **`archived_at`** - 采纳/归档时间 ⚠️ **必需**
   - 必须提供，表示文章被采纳的时间
   - 格式：ISO 8601（如：`2025-01-08T10:00:00Z`）
   - 归档函数会自动设置：`datetime.now().isoformat() + "Z"`

6. **`created_at`** - 创建时间
   - 如果归档时没有，系统会自动设置为当前时间
   - 格式：ISO 8601

## 📝 可选字段（Optional Fields）

以下字段是可选的，但建议提供：

1. **`source`** - 来源
   - 如果为空字符串或不存在，UI显示"未知来源"
   - 爬取的资讯统一使用"100kwhy"作为来源
   - 建议填写公众号名或网站名

2. **`summary`** - 文章摘要
   - 用于在列表中显示文章简介

3. **`published_time`** - 原始发布时间
   - 如果归档时没有，系统会使用 `created_at` 的值

4. **`tool_tags`** - 工具标签列表
   - 用于工具详情页关联相关文章
   - 格式：字符串数组，如：`["Cursor", "Aider"]`

5. **`tags`** - 普通标签列表
   - 用于分类和搜索
   - 格式：字符串数组

6. **`view_count`** - 点击次数
   - 用于计算热度，默认为0
   - 每次点击文章链接时自动增加

7. **`score`** - 热度分
   - 0-10的评分，用于排序

## 🔄 归档时的自动处理

当调用 `DataLoader.archive_article_to_category()` 归档文章时，系统会自动：

1. **生成ID**（如果没有）：
   - 从所有文章文件中找到最大ID，然后+1

2. **设置时间戳**：
   - `created_at`：如果不存在，设置为当前时间
   - `published_time`：如果不存在，使用 `created_at` 的值
   - `archived_at`：**强制设置为当前时间**（采纳时间）

3. **设置分类**：
   - `category`：设置为指定的分类值

4. **初始化默认值**：
   - `view_count`：如果不存在，设置为0

5. **处理工具标签**：
   - 如果提供了 `tool_tags`，会同时添加到 `tags` 中（去重）

## 📂 文件存储位置

根据分类，文章会存储到对应的JSON文件：

- `category="programming"` → `data/articles/programming.json`
- `category="ai_news"` → `data/articles/ai_news.json`

## ⚠️ 重要注意事项

1. **`archived_at` 是必需字段**：
   - 归档函数会强制设置此字段
   - UI显示日期时优先使用此字段
   - 如果现有数据缺少此字段，系统会在加载时使用文件修改时间补充

2. **数据去重**：
   - 基于 `id` 或 `url` 去重
   - 如果URL已存在，归档会失败

3. **日期格式**：
   - 所有日期字段使用 ISO 8601 格式
   - 示例：`2025-01-08T10:00:00Z`

4. **向后兼容**：
   - 如果加载的文章缺少日期字段，系统会自动补充
   - 使用文件修改时间作为 `archived_at` 的默认值

5. **来源字段**：
   - 爬取的资讯统一使用"100kwhy"作为来源
   - 用户提交的资讯保持原有来源标识

## 🔧 数据迁移

如果现有数据缺少必需字段，可以：

1. **手动更新JSON文件**：添加缺失的字段
2. **使用归档函数重新归档**：系统会自动补充所有必需字段
3. **系统自动补充**：加载时会自动使用文件修改时间补充日期字段

## 📌 相关代码位置

- **归档函数**：`app/services/data_loader.py::archive_article_to_category()`
- **加载函数**：`app/services/data_loader.py::get_articles()`
- **数据模型文档**：`data/README.md`


